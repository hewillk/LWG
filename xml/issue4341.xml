<?xml version='1.0' encoding='utf-8' standalone='no'?>
<!DOCTYPE issue SYSTEM "lwg-issue.dtd">

<issue num="4341" status="Voting">
<title>Missing rvalue reference qualification for <code>task::connect()</code></title>
<section><sref ref="[task.class]"/></section>
<submitter>Dietmar KÃ¼hl</submitter>
<date>31 Aug 2025</date>
<priority>99</priority>

<discussion>
<b>Addresses <a href="https://github.com/cplusplus/nbballot/issues/950">US 244-375</a></b>
<p>
Coroutines can't be copied. Thus, a <code>task</code> can be
<code>connect()</code> just once.  To represent that
<code>task::connect()</code> should be rvalue reference qualified
but currently it isn't.
</p>

<note>2025-10-17; Reflector poll.</note>
<p>
Set status to Tentatively Ready after five votes in favour during reflector poll.
</p>
<p>
"It's nice to rvalue qualify such a function, but it is not strictly necessary."
</p>
</discussion>

<resolution>
<p>
In the synopsis in <sref ref="[task.class]"/> add rvalue
reference qualification to <code>task::connect()</code>:
<blockquote><pre>
namespace std::execution {
  template&lt;class T, class Environment&gt;
  class task {
    ...
    template&lt;receiver Rcvr&gt;
        <i>state</i>&lt;Rcvr&gt; connect(Rcvr&amp;&amp; rcvr) <ins>&amp;&amp;</ins>;
    ...
  }
}
</pre></blockquote>
</p>
<p>
In the specification in <sref ref="[task.members]"/> paragraph 3 add rvalue
reference qualification to <code>task::connect()</code>:
<blockquote>
<pre>
template&lt;receiver Rcvr&gt;
    <i>state</i>&lt;Rcvr&gt; connect(Rcvr&amp;&amp; rcvr) <ins>&amp;&amp;</ins>;
</pre>
<p>-3- <i>Precondition</i>: <code>bool(handle)</code> is <code>true</code>.</p>
<p>-4- <i>Effects</i>: Equivalent to:</p>
<pre>    return state&lt;Rcvr&gt;(exchange(handle, {}), std::forward&lt;Rcvr&gt;(recv));</pre>
</blockquote>
</p>
</resolution>

</issue>
